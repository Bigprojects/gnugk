<sect>Configuración de Enrutado
<p>
Las siguientes secciones del archivo de configuración pueden ser usadas para configurar el enrutamiento de las llamadas.

<sect1>Sección &lsqb;Políticas de enrutado&rsqb;
<label id="routingpolicy">
<p>
Esta sección explica el funcionamiento de las diversas políticas de enrutado del gatekeeper.

Las peticiones de llamada entrante pueden ser encaminadas usando un número de proovedores de enrutado:

<itemize>

<item><tt/explicit/<newline>
<p>
El destinatario se detalla de manera explícita en la petición de enrutado.

<item><tt/internal/<newline>
<p>
La regla clásica; buscar el destinatario en la tabla de registro RegistrationTable

<item><tt/parent/<newline>
<p>
Enruta la llamada con la información obtenida de la respuesta del GK padre a un ARQ enviado por el gatekeeper.

<item><tt/neighbor/<newline>
<p>
Enruta la llamada usando vecinos a través de mensajes LRQ

<item><tt/dns/<newline>
<p>
El destino se obtiene del DNS, dado que es obtenible.

<item><tt/vqueue/<newline>
<p>

Usar el mecanismo de cola virtual y generar un evento RouteRequest para permitir manejar el enrutado a una 
aplicación externa (sólo puede ser usada OnARQ)
</itemize>

Las políticas se prueban de manera sucesiva hasta hallar la correcta.

Estas políticas pueden ser aplicadas a diversos tipos de peticiones de enrutado, y datos de entrada de enrutado. 
Éstos son los siguientes:
ARQ, LRQ, Setup y Facility (con la razón callForwarded)
Existe también una política general, que viene a ser la opción por defecto frente a los otros tipos.

<descrip>
<tag/Example:/
<quote><tt>[RoutingPolicy]<newline>
h323_ID=dns,internal<newline>
002=neighbor,internal<newline>
Default=internal,neighbor,parent</tt></quote>
</descrip>

Cuando un mensaje que llama a una decisión de enrutado se recibe, 
todas las llamadas a un alias del tipo h323_ID serán resueltas 
a través de DNS. Si esto no soluciona el alias, se comprueba contra las 
tablas de registro internas. Si se pide un alias que comience con 002, 
los vecinos se comprueban antes de las tablas de registro. Si el 
alias solicitado no es del tipo h323_ID o comienza por 002, se usa la 
política por defecto consultando las tablas de registro internas, tras 
ellas, a los vecinos, y, en caso de fallo, al padre.

Para los mensajes ARQ, LRQ, Setup y Facility se deberían usar las secciones
 [RoutingPolicy::OnARQ], 
[RoutingPolicy::OnLRQ], [RoutingPolicy::OnSetup] y [RoutingPolicy::OnFacility] 
usando la sintaxis anteriormente explicada.


<sect1>Sección &lsqb;RasSrv::RewriteE164&rsqb;
<label id="rewrite">
<p>
Esta sección define las reglas de reescritura para dialedDigits (números E.164)

<descrip>
<tag/Format:/
<tt>[!]original-prefix=target-prefix</tt>
<p>

Si el número comienza con <tt/original-prefix/,
se reescribe a <tt/target-prefix/.
Si la bandera `<tt/!/' precede a <tt/original-prefix/, se invierte el sentido
y el prefijo del objetivo se antepone al número marcado. Se permiten los comodines especiales 
(<tt/'.'/ y <tt/'%'/).
<tag/Example:/
<tt/08=18888/
<p>
Si se marca <tt/08345718/, se reescribe a <tt/18888345718/.
<tag/Example:/
<tt/!08=18888/
<p>
Si se marca <tt/09345718/, se reescribe a <tt/1888809345718/.
</descrip>

Opción:
<itemize>
<item><tt/Fastmatch=08/<newline>
Por defecto: <tt>N/A</tt>
<p>
Sólo reescribe dialDigits que comiencen con el prefijo especificado.
</itemize>


<sect1>Sección &lsqb;RasSrv::GWRewriteE164&rsqb;
<label id="gwrewrite">
<p>
Esta sección describe la reescritura de números dialedDigits E.164 en función de
si si llega o se envía la llamada de la puerta de enlace. Esto permite manipulación más flexible 
de los dialedDigits para enrutado y demás. En combinación con el <ref id="rewrite" name="RasSrv::RewriteE164"> 
se puede reescribir en tres fases:

<tscreen><verb>
Llamada de "gw1", dialedDigits 0867822
		|
		|
		V
Reglas de entradas para "gw1", dialedDigits ahora son 550867822
		|
		|
		V
Reglas globales, dialedDigits ahora son 440867822
		|
		|
		V
Selección de puerta de enlace, dialedDigits ahora son 440867822, puerta de enlace de cara al exterior "gw2"
		|
		|
		V
Reglas de salida para "gw2", dialedDigits ahora son 0867822
		|
		|
		V
Llamada a "gw2", dialedDigits 0867822
</verb></tscreen>

<descrip>
<tag/Format:/
<tt>gw-alias=in|out=[!]original-prefix=target-prefix[;in|out...]</tt>
<p>
Si la llamada encaja con la puerta de enlace, la dirección y comienza con 
<tt/original-prefix/ se reescribe a <tt/target-prefix/.
Si la bandera `<tt/!/' precede a <tt/original-prefix/, el sentido se invierte.
Se permiten los caracteres especiales (<tt/'.'/ and <tt/'%'/).
Es preciso separar con ';' las diversas reglas para una misma puerta de enlace.

<tag/Example:/
<tt/gw1=in=123=321/
<p>
Si se recibe una llamada de "gw1" a <tt/12377897/, se reescribe a <tt/32177897/
antes de acometer cualquier otra acción.
</descrip>


<sect1>Sección &lsqb;Endpoint::RewriteE164&rsqb;
<p>
Una vez especificado el/los registro/s para el punto final de la puerta de enlace, 
el gatekeeper padre enrutará las llamadas con <bf/dialedDigits/ comenzando con esos prefijos.

El gatekeeper hijo puede reescribir el destino de acuerdo a las reglas especificadas en esta sección.
En contraste, cuando un punto final interno llama a un punto final registrado en el padre, la fuente 
se escribirá a inversas.

<descrip>
<tag/Format:/
<tt/external prefix=internal prefix/
</descrip>

Por ejemplo, con la siguiente configuración:

<tscreen><verb>
                        [Parent GK]
                        ID=CitronGK
                        /         \
                       /           \
                      /             \
                     /               \
                [Child GK]          [EP3]
                ID=ProxyGK          E164=18888200
                Prefix=188886
                /       \
               /         \
              /           \
           [EP1]         [EP2]
           E164=601      E164=602
</verb></tscreen>

Con la regla:
<tscreen><verb>
188886=6
</verb></tscreen>

Cuando EP1 llame EP3 por <tt/18888200/, el CallingPartyNumber en el Setup Q.931
se reescribirá a <tt/18888601/. 
A inversas, EP3 alcanza EP1 y EP2 llamando a <tt/18888601/ y <tt/18888602/, 
respectivamente. Por tanto, un punto final registrado al GK hijo con prefijo '<tt/6/' aparecerá
como un punto final con prefijo '<tt/188886/', para los puntos finales registrados al padre.

La sección no se relaciona con la sección
<ref id="rewrite" name="RasSrv::RewriteE164">,
aunque la última tendrá efecto antes.

