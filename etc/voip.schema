# -*- text -*-
# Copyright (C) 2001 mediaWays GmbH, Verl, Germany
# Authors: Dr.-Ing. Martin Froehlich <Martin.Froehlich@mediaWays.net>
#          Based on ideas of Mathias Barkow and Markus Storm
#
# PURPOSE OF THIS FILE:
#    Definition of a LDAP-schema (OpenLDAP format) to represent VoIP endpoints
#
#
# This schema is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
#
#  OIDs (see also http://www.alvestrand.no/harald/objectid/) for mediaWays:
#
#  1.3.6.1.4.1.9564       = mediaWays
#  1.3.6.1.4.1.9564.1     = object classes
#  1.3.6.1.4.1.9564.1.1   = mediaWays object classes
#  1.3.6.1.4.1.9564.1.5   = VoIP object classes
#  1.3.6.1.4.1.9564.2     = attributes
#  1.3.6.1.4.1.9564.2.1   = mediaWays attributes
#  1.3.6.1.4.1.9564.2.5   = VoIP attributes
#
#  Feel free to replace "9564" by your own IANA-assigned OID.
#
# SYNTAX overview
# binary                     1.3.6.1.4.1.1466.115.121.1.5  BER/DER data
# boolean		     1.3.6.1.4.1.1466.115.121.1.7  boolean value
# distinguishedName          1.3.6.1.4.1.1466.115.121.1.12 DN
# directoryString	     1.3.6.1.4.1.1466.115.121.1.15 UTF-8 string
# Facsimile Telephone Number 1.3.6.1.4.1.1466.115.121.1.22
# IA5String		     1.3.6.1.4.1.1466.115.121.1.26 ASCII string
# Integer	             1.3.6.1.4.1.1466.115.121.1.27 integer
# Name and Optional UID      1.3.6.1.4.1.1466.115.121.1.34 DN plus UID
# Numeric String	     1.3.6.1.4.1.1466.115.121.1.36 numeric string
# OID			     1.3.6.1.4.1.1466.115.121.1.38 object identifier
# Octet String		     1.3.6.1.4.1.1466.115.121.1.40 arbitary octets
# Printable String           1.3.6.1.4.1.1466.115.121.1.44 printable string
# Telephone Number           1.3.6.1.4.1.1466.115.121.1.50 E.123 string
#
#
# LDAP attribute		    | defined in
# -----------------------------------------------------------------------------
# mail				    | RFC 2256(core), OID 0.9.2342.19200300.100.1.3
# telephoneNumber		    | RFC 2256(core), OID 2.5.4.20
# facsimileTelephoneNumber	    | RFC 2256(core), OID 2.5.4.23
# plaintextPassword		    | your-own-class (mediaWays: mways)
#
# voIPlocalAccessCode		    | HERE
# voIPnationalAccessCode	    | HERE
# voIPinternationalAccessCode	    | HERE
# voIPsubscriberTelephoneNumber	    | HERE
# voIPmainTelephoneNumber	    | HERE
# voIPcallingLineIdRestriction	    | HERE
# voIPspecialDial                   | HERE
# voIPhonorsARJincompleteAddress    | HERE
# voIPStatusEnquiryInterval         | HERE
# voIPprependCallbackAccessCode     | HERE
# voIPCountryCode                   | HERE
# voIPNationalDestinationCode       | HERE
# voIPEndpointType                  | HERE
# voIPWhiteListBeforeBlackList      | HERE
# voIPprefixOutgoingBlacklist       | HERE
# voIPprefixOutgoingWhitelist       | HERE
# voIPprefixIncomingBlacklist       | HERE
# voIPprefixIncomingWhitelist       | HERE
# voIPCallTimeout                   | HERE
# voIPTreatCallingPartyNumberAs     | HERE
# voIPTreatCalledPartyNumberAs      | HERE
# voIPConvertToLocal                | HERE
# voIPvoIPMinimumDigitsRequired     | HERE

# This objectClass shall be used to extend entries which typically are
# either also of class 'person' or 'inetOrgPerson', 'mways'
# OR are structural nodes like 'organizationalUnit' located above of those
# objects representing users.


# A) VoIP User
#
# A.1) Attributes also used in standard classes. Your LDAP server should already
#      know about these.
#
# NOTE:
# In order to have a unique H.323 ID to avoid registration clashing, we use
# a user's primary e-mail address as his H.323 ID.
# Neither "uid" nor "cn" are guaranteed to be unique.
# Two users with the same uid trying to register with their uid as a H.323 alias would
# result in RRJ for the second user, and he would certainly not understand why !
# For gateways, that address needs to be artificially constructed.
# We use <host>@voip.<yourdomain>. <host> is a DNS name without dots (i.e., the hostname).
# That's SIP-compatible, by the way (Jehova !) :-)
#
# attributetype ( 0.9.2342.19200300.100.1.3 NAME ( 'mail' 'rfc822Mailbox' )
#   DESC 'RFC1274: RFC822 Mailbox'
#   EQUALITY caseIgnoreIA5Match
#   SUBSTR caseIgnoreIA5SubstringsMatch
#   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26{256} )
#
#
# NOTE:
# telephoneNumber defines the prefix(es) and number(s) assigned to gateways
# and terminals, respectively.
# According to RFC 2256, E.123 defines the format to be used for the
# telephoneNumber attribute. See http://www.ngi.org/enum/pub/Draft_Rec_E123.htm
#
# We need to further refine this definition as follows:
# telephoneNumber: 49524680....
#
# Dots are important! Each dot is a placeholder for a single cipher, i.e. 0-9.
# To correctly implement the screening functionality, we need to know how long
# a number actually is. We also need this to handle overlapped receiving for
# endpoints that don't support it themselves.
# The above value of telephoneNumber defines the number space for a gateway
# starting with the base number 49524680 and allowing for an extension
# of exactly four ciphers. Attention: for every dot, all ciphers to the right
# of this dot must be dots, too ! Otherwise the routing algorithm may fail.
# Decomposition of this number into country code (cc), national destination code (ndc),
# subscriber number (sn) and extension (ext) is needed for virtual numbering
# plan support, so you need to store these in separate attributes
# (voIPCountryCode, voIPnationalDestinationCode and voIPsubscriberNumber).
# Multiple occurences of the telephoneNumber attribute may be used to define
# further prefixes / subscriber numbers. 
# A fully qualified number used to represent a terminal would be e.g. "495246801867".
# A fully qualified number used to represent a CPE gateway would be e.g. "49524180....".
#
# attributetype ( 2.5.4.20 NAME 'telephoneNumber'
#   DESC 'telephoneNumber in E.123 format'
#   EQUALITY telephoneNumberMatch
#   SUBSTR telephoneNumberSubstringsMatch
#   SYNTAX 1.3.6.1.4.1.1466.115.121.1.50{32} )
#
# NOTE:
# Used for fax-2-mail, which is not part of the gatekeeper.
# Fax receipt must be implemented separately.
# attributetype ( 2.5.4.23 NAME ( 'facsimileTelephoneNumber' 'fax' )
#        SYNTAX 1.3.6.1.4.1.1466.115.121.1.22 )

#
# A.2) Attributes also used in other mediaWays classes. You may
#      need to remove the comment signs for some of them if you do not
#      have the 'mways.schema'-file.
#
# NOTE:
# The gatekeeper needs a plaintext password in order to calculate H.235 hashes.
# plaintextPassword contains the user's password in cleartext or
# encrypted with a 2-way mechanism.
# The 'userpassword' attribute is usually one-way-encrypted (CRYPT or SHA-1)
# and therefore cannot be used.
# To avoid storing cleartext passwords here, you may implement your own
# 2-way encryption method. You should denote the used method within the value
# like you do with the userpassword attribute, i.e.
# "plaintextPassword: {3DES}XXXXX" COULD mean XXXXX is a triple-DES encrypted password.
# Your LDAP client needs to interpret the {...} part and, of course, must implement
# the appropriate decryption routine. Feel free to implement {MY_OWN_ENCRYPTION_SCHEME}.
#
# attributetype ( 1.3.6.1.4.1.9564.2.1.1.8 NAME 'plaintextPassword'
#   DESC 'password of user -- cleartext or 2-way encrypted'
#   EQUALITY octetStringMatch
#   SYNTAX 1.3.6.1.4.1.1466.115.121.1.40{128} )
#
#
#
# A.3) Attributes dedicated to VoIP. They are defined HERE.

# NOTE:
# endpoints that do not support H.235 may be authenticated according to their
# source IP address. This attribute's values define allowed source IP addresses.

attributeType ( 1.3.6.1.4.1.9564.2.5.2010
  NAME ( 'voIPIpAddress' 'voIPip' )
  DESC 'A user or gateway IP address'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.26
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2020
  NAME ( 'voIPlocalAccessCode' 'voIPlac' )
  DESC 'The prefix code to be dialled to indicate a local area call destination'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2030
  NAME ('voIPnationalAccessCode' 'voIPnac' )
  DESC 'The prefix code to be dialled to indicate a national call destination'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2040
  NAME ( 'voIPinternationalAccessCode' 'voIPinac' )
  DESC 'The prefix code to be dialled to indicate an international call destination'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
  SINGLE-VALUE
 )

# NOTE: only sn is stored, i.e. for a number +49 5241 80-1234,
# we store "80".
attributeType ( 1.3.6.1.4.1.9564.2.5.2050
  NAME ( 'voIPsubscriberTelephoneNumber' 'voIPsn' )
  DESC 'The subscriber base number to be prepended to internal calls'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
  SINGLE-VALUE
 )

# NOTE: to be stored in international format ("495241801234")
attributeType ( 1.3.6.1.4.1.9564.2.5.2060
  NAME ( 'voIPmainTelephoneNumber' )
  DESC 'The calling number to be presented to the callee if no or wrong CLIs are given'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2070
  NAME ( 'voIPcallingLineIdRestriction' 'voIPclir' )
  DESC 'Indicates whether the calling line ID is to be restricted'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
  SINGLE-VALUE
 )

# NOTE:
# voIPspecialDial attributes must contain values of the format
# <special>=<telephoneNumber>, e.g. "110=495241801234".
# special may be an arbitrary E.164 string while telephoneNumber must match
# the format used in the telephoneNumber attribute.
# This attribute is multi-valued to allow for multiple special number
# conversions. Emergency call numbers are implemented
# like this to convert 911 (110, 112 in Germany) to the closest possible
# (dependant on caller's number) local number.
#

attributeType ( 1.3.6.1.4.1.9564.2.5.2080 NAME 'voIPspecialDial'
  DESC 'network-side, user specific number conversions'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.26
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2090 NAME 'voIPhonorsARJincompleteAddress'
  DESC 'defines whether the gateway accepts ARJs with reason IncompleteAddress'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
  SINGLE-VALUE
 )

# NOTE:
# causes the destination's inac (for international calls) or nac (for national
# calls) to be prepended to the calling party number.
# This transforms the calling party number into a number the destination
# can directly call back (without having to manually type nac/inac + number)

attributeType ( 1.3.6.1.4.1.9564.2.5.2100
  NAME ( 'voIPprependCallbackAccessCode' 'voIPprependCallbackAC' )
  DESC 'defines whether to prepend inac/nac to calling party number'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
  SINGLE-VALUE
 )

# NOTE: reserved for future use only
attributeType ( 1.3.6.1.4.1.9564.2.5.2110 NAME 'voIPStatusEnquiryInterval'
  DESC 'defines interval between Q.931 Status Enquiry pings (0 to disable pings)'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2120
  NAME ( 'voIPCountryCode' 'voIPcc' )
  EQUALITY numericStringMatch
  DESC 'the ITU country code of the user or gateway; to be prepended to CgPN or CdPN if needed'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{3}
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2130
  NAME ( 'voIPNationalDestinationCode' 'voIPndc' )
  EQUALITY numericStringMatch
  DESC 'the ITU national destination code of the user or gateway; to be prepended to CgPN or CdPN if needed'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{3}
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2140 NAME 'voIPEndpointType'
  DESC 'a gateway is either of type cpe (customer premise equipment), trunk (operator-side gateways) or neighbor (another gatekeeper)'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.26
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2150 NAME 'voIPWhiteListBeforeBlackList'
  DESC 'defines whether WhiteBlackListDestAnalysis should be applied instead of default BlackWhiteListDestAnalysis'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2160 NAME 'voIPPrefixOutgoingBlacklist'
  EQUALITY numericStringMatch
  DESC 'A blocked destination prefix for this caller'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2170 NAME 'voIPPrefixOutgoingWhitelist'
  EQUALITY numericStringMatch
  DESC 'An accessible destination prefix for this caller (overriding blacklisted entries)'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2180 NAME 'voIPPrefixIncomingBlacklist'
  EQUALITY numericStringMatch
  DESC 'Incoming callers to be blocked'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2190 NAME 'voIPPrefixIncomingWhitelist'
  EQUALITY numericStringMatch
  DESC 'Incoming callers to be allowed (overriding blacklisted entries)'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.44{16}
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2200 NAME 'voIPCallTimeout'
  DESC 'Maximum number of seconds left on the callers time account. If 0, call will be terminated by the network.'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
  SINGLE-VALUE
)

attributeType ( 1.3.6.1.4.1.9564.2.5.2210 NAME 'voIPConvertToLocal'
  DESC 'Convert Numbers to national/subscriber type when calls are national/local. Default is to leave them international'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2220 NAME 'voIPTreatCallingPartyNumberAs'
  DESC 'Treat CallingPartyNumber as a international/national/subscriber type number or rely on the ToN in Q.931'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2230 NAME 'voIPTreatCalledPartyNumberAs'
  DESC 'Treat CalledPartyNumber as a international/national/subscriber type number or rely on the ToN in Q.931'
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
  SINGLE-VALUE
 )

attributeType ( 1.3.6.1.4.1.9564.2.5.2240 NAME 'voIPMinimumDigitsRequired'
  DESC 'minimum number of digits required to be collected prior to routing a call to this endpoint '
  SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
  SINGLE-VALUE
 )



# A.4) Object classes dedicated to VoIP. They are defined HERE.

objectClass ( 1.3.6.1.4.1.9564.1.5.1000 NAME 'voIPProperty'
  SUP top ABSTRACT
  DESC 'Objects of this class can be used to provide VoIP-Equipment with
        user-related access and authentification information'
  MAY ( mail $ telephoneNumber $ facsimiletelephoneNumber $
	plaintextPassword $ voIPIpAddress $
	voIPsubscriberTelephoneNumber $ voIPmainTelephoneNumber $
	voIPlocalAccessCode $ voIPnationalAccessCode $ voIPinternationalAccessCode $
	voIPhonorsARJincompleteAddress $ voIPprependCallbackAccessCode $
	voIPcallingLineIdRestriction $ voIPspecialDial $ voIPStatusEnquiryInterval $
	voIPCountryCode $ voIPnationalDestinationCode $ voIPEndpointType $
	voIPprefixIncomingBlacklist $ voIPprefixOutgoingBlacklist $
	voIPprefixIncomingWhitelist $ voIPprefixOutgoingWhitelist $
	voIPWhiteListBeforeBlackList $ voIPConvertToLocal $ voIPCallTimeout $
	voIPTreatCallingPartyNumberAs $ voIPTreatCalledPartyNumberAs ) )




# B) LDAP tree structure

# B.1) recommended tree structure
#
# You do not need to setup your LDAP tree like this. It's just a recommendation.
# The exact attributes used to compose the DN (distinguished name; the primary LDAP
# key) are irrelevant. If you intend to use "default values", however, DNs must
# represent the tree structure, i.e. to get from a subnode to it's parent node, cut off
# the leading component (a.k.a. "RDN") from the DN string.
#
# A common search root for both, the subtree containing all the terminals and
# the subtree containing all the gateways, is assumed. In the following example,
# this common search root is "o=mediaways.net".
# Go with something like OpenLDAP's back-meta if you need to tie multiple servers
# or multiple trees together under a single root.
# To allow for further, LDAP-like representation below this root, entries need not
# be direct childs of the search root. In the following example, "ou=mediaWays"
# is a organizational unit representing the customer "mediaWays". Other ou's like
# "ou=customerX, o=mediaways.net" may exist and contain VoIP entries to be used.

# NOTE:
# Default values may be stored as attributes to parent nodes, i.e.
# values stored down the tree override values higher up in the tree.
# An entry's parent node is "guessed" by eliminating the RDN (first component of
# the entry's DN). Currently, there's no way to change this assumption.
# Browsing up the tree can stop when encountering "top nodes".
# Top nodes are the highest nodes within a subtree structure that still contain
# the voIPProperty objectclass.


# B.2) Examples
#
# The following LDAP entry
#
# dn: cn=Markus Storm, ou=Technology, ou=mediaWays, o=mediaways.net
# objectclass:       voIPProperty
# mail:              markus.storm@mediaways.net
# telephoneNumber:   495246801867
# telephoneNumber:   495246806867
# plaintextpassword: {3DES}X1Y2Z3
#
# defines a terminal that may register with an H.323 ID of "markus.storm@mediaways.net"
# and E.164 ID of +49 5246 80 1867 and +49 5246 80 6867.
# H.235 is required and triple DES was used to create the encrypted password "X1Y2Z3".
# (This is just an example, triple DES is NOT implemented !).

# In case any attributes that are not defined within this entry but are
# needed to perform a certain operation (e.g. Blacklist/Whitelist comparison),
# can be extracted from this DN's parent nodes.
# E.g. if looking for voIPprefixOutgoingWhiteList, the node "ou=Technology, ou=mediaWays,
# o=mediaways.net" is being queried whether it has a voIPprefixOutgoingWhiteList
# attribute; if is has not, the node "ou=mediaWays, o=mediaways.net" is queried.
# This assumes that both nodes, "ou=Technology, ou=mediaWays, o=mediaways.net" and
# "ou=mediaWays, o=mediaways.net", have the attribute "objectclass=voIPproperty" AND
# the node "o=mediaways.net" does NOT have it.

# Residential gateways are referenced by a LDAP-like representation of their DNS name.
# Only the last element needs to be common to both, terminal and gateway subtrees to serve
# as the  search root. The following example represents a gateway.
# It's DNS name tbag-gtso-de01.voip.mediaways.net resolves to IP address 1.2.3.4 .

#
# (Residential) gateways are represented as follows:
#
# dn: dc=tbag-gtso-de01, dc=voip, o=mediaways.net
# objectclass:     voIPProperty
# mail:            tbag-gtso-de01@voip.mediaways.net
# voIPip:          1.2.3.4
# telephoneNumber: 49524180....
# telephoneNumber: 4952418020...
#
# The dn is built of multiple dc parts (domain components) that represent
# the gateway's DNS name. The o=mediaways.net is the search root common to
# both subtrees, the one storing terminal and the other storing gateways.
#
# This gateway is not required to use H.235 but it is authenticated by it's
# packets' source IP address which is 1.2.3.4.
# Calls to +49 5241 80 XXXX and +49 5241 80 20XXX are routed to this gateway
# (X being a single cipher).
# A call to e.g. +49 5241 80 21234 is NOT routed to this gateway.
